import{d2 as N,e0 as x,cJ as it,eT as ot,j as st,bL as w,as as z,ah as C,a9 as M,ae as j,ea as at,al as R,hN as tt,em as I,dU as G,cq as ut,eC as S,eU as ht,i2 as nt,eS as dt,e5 as K}from"./graph_model-BrF80QgO.js";import"./react-vendor-CViWwmvK.js";/**
    * @license
    * Copyright 2023 Google LLC. All Rights Reserved.
    * Licensed under the Apache License, Version 2.0 (the "License");
    * you may not use this file except in compliance with the License.
    * You may obtain a copy of the License at
    *
    * http://www.apache.org/licenses/LICENSE-2.0
    *
    * Unless required by applicable law or agreed to in writing, software
    * distributed under the License is distributed on an "AS IS" BASIS,
    * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    * See the License for the specific language governing permissions and
    * limitations under the License.
    * =============================================================================
    */function y(i,e,r,t){return new(r||(r=Promise))(function(n,s){function a(c){try{d(t.next(c))}catch(o){s(o)}}function u(c){try{d(t.throw(c))}catch(o){s(o)}}function d(c){var o;c.done?n(c.value):(o=c.value,o instanceof r?o:new r(function(f){f(o)})).then(a,u)}d((t=t.apply(i,[])).next())})}function k(i,e){var r,t,n,s,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function u(d){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s&&(s=0,o[0]&&(a=0)),a;)try{if(r=1,t&&(n=2&o[0]?t.return:o[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,o[1])).done)return n;switch(t=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,t=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(n=a.trys,!((n=n.length>0&&n[n.length-1])||o[0]!==6&&o[0]!==2)){a=0;continue}if(o[0]===3&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(o[0]===6&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(i,a)}catch(f){o=[6,f],t=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([d,c])}}}function B(i,e,r){if(r||arguments.length===2)for(var t,n=0,s=e.length;n<s;n++)!t&&n in e||(t||(t=Array.prototype.slice.call(e,0,n)),t[n]=e[n]);return i.concat(t||Array.prototype.slice.call(e))}function V(i){return[Math.abs(i.endPoint[0]-i.startPoint[0]),Math.abs(i.endPoint[1]-i.startPoint[1])]}function E(i){return[i.startPoint[0]+(i.endPoint[0]-i.startPoint[0])/2,i.startPoint[1]+(i.endPoint[1]-i.startPoint[1])/2]}function U(i,e){e===void 0&&(e=1.5);var r=E(i),t=V(i),n=[e*t[0]/2,e*t[1]/2];return{startPoint:[r[0]-n[0],r[1]-n[1]],endPoint:[r[0]+n[0],r[1]+n[1]],palmLandmarks:i.palmLandmarks}}function q(i){var e=E(i),r=V(i),t=Math.max.apply(Math,r)/2;return{startPoint:[e[0]-t,e[1]-t],endPoint:[e[0]+t,e[1]+t],palmLandmarks:i.palmLandmarks}}function J(i,e){var r=[i.endPoint[0]-i.startPoint[0],i.endPoint[1]-i.startPoint[1]],t=[r[0]*e[0],r[1]*e[1]];return{startPoint:[i.startPoint[0]+t[0],i.startPoint[1]+t[1]],endPoint:[i.endPoint[0]+t[0],i.endPoint[1]+t[1]],palmLandmarks:i.palmLandmarks}}var ct=function(){function i(e,r,t,n,s,a){this.model=e,this.width=r,this.height=t,this.iouThreshold=s,this.scoreThreshold=a,this.anchors=n.map(function(u){return[u.x_center,u.y_center]}),this.anchorsTensor=dt(this.anchors),this.inputSizeTensor=K([r,t]),this.doubleInputSizeTensor=K([2*r,2*t])}return i.prototype.normalizeBoxes=function(e){var r=this;return x(function(){var t=w(e,[0,0],[-1,2]),n=w(e,[0,2],[-1,2]),s=z(C(t,r.inputSizeTensor),r.anchorsTensor),a=C(n,r.doubleInputSizeTensor),u=M(j(s,a),r.inputSizeTensor),d=M(z(s,a),r.inputSizeTensor);return at([u,d],1)})},i.prototype.normalizeLandmarks=function(e,r){var t=this;return x(function(){var n=z(C(R(e,[-1,7,2]),t.inputSizeTensor),t.anchors[r]);return M(n,t.inputSizeTensor)})},i.prototype.getBoundingBoxes=function(e){return y(this,void 0,void 0,function(){var r,t,n,s,a,u,d,c,o,f,l,h,m,v,g,P=this;return k(this,function(p){switch(p.label){case 0:return r=x(function(){return M(j(e,.5),2)}),tt()==="webgl"?(n=I().get("WEBGL_PACK_DEPTHWISECONV"),I().set("WEBGL_PACK_DEPTHWISECONV",!0),t=this.model.predict(r),I().set("WEBGL_PACK_DEPTHWISECONV",n)):t=this.model.predict(r),s=G(t),a=x(function(){return G(ut(w(s,[0,0],[-1,1])))}),u=w(s,[0,1],[-1,4]),d=this.normalizeBoxes(u),c=console.warn,console.warn=function(){},o=S.nonMaxSuppression(d,a,1,this.iouThreshold,this.scoreThreshold),console.warn=c,[4,o.array()];case 1:return f=p.sent(),l=[r,t,o,s,d,u,a],f.length===0?(l.forEach(function(b){return b.dispose()}),[2,null]):(h=f[0],m=w(d,[h,0],[1,-1]),v=w(s,[h,5],[1,14]),g=x(function(){return R(P.normalizeLandmarks(v,h),[-1,2])}),l.push(v),l.forEach(function(b){return b.dispose()}),[2,{boxes:m,palmLandmarks:g}])}})})},i.prototype.estimateHandBounds=function(e){return y(this,void 0,void 0,function(){var r,t,n,s,a,u,d,c,o=this;return k(this,function(f){switch(f.label){case 0:return r=e.shape[1],t=e.shape[2],n=x(function(){return C(S.resizeBilinear(e,[o.width,o.height]),255)}),[4,this.getBoundingBoxes(n)];case 1:return(s=f.sent())===null?(n.dispose(),[2,null]):(a=s.boxes.arraySync(),u=a[0].slice(0,2),d=a[0].slice(2,4),c=s.palmLandmarks.arraySync(),n.dispose(),s.boxes.dispose(),s.palmLandmarks.dispose(),[2,(l={startPoint:u,endPoint:d,palmLandmarks:c},h=[t/this.width,r/this.height],{startPoint:[l.startPoint[0]*h[0],l.startPoint[1]*h[1]],endPoint:[l.endPoint[0]*h[0],l.endPoint[1]*h[1]],palmLandmarks:l.palmLandmarks.map(function(m){return[m[0]*h[0],m[1]*h[1]]})})])}var l,h})})},i}(),_={thumb:[1,2,3,4],indexFinger:[5,6,7,8],middleFinger:[9,10,11,12],ringFinger:[13,14,15,16],pinky:[17,18,19,20],palmBase:[0]};function ft(i,e){var r,t=Math.PI/2-Math.atan2(-(e[1]-i[1]),e[0]-i[0]);return(r=t)-2*Math.PI*Math.floor((r+Math.PI)/(2*Math.PI))}var Q=function(i,e){return[[1,0,i],[0,1,e],[0,0,1]]};function L(i,e){for(var r=0,t=0;t<i.length;t++)r+=i[t]*e[t];return r}function lt(i,e){for(var r=[],t=0;t<i.length;t++)r.push(i[t][e]);return r}function X(i,e){for(var r=[],t=i.length,n=0;n<t;n++){r.push([]);for(var s=0;s<t;s++)r[n].push(L(i[n],lt(e,s)))}return r}function Y(i,e){var r=Math.cos(i),t=Math.sin(i),n=[[r,-t,0],[t,r,0],[0,0,1]],s=X(Q(e[0],e[1]),n);return X(s,Q(-e[0],-e[1]))}function Z(i,e){return[L(i,e[0]),L(i,e[1])]}var pt=[0,-.4],mt=[0,-.1],$=[0,5,9,13,17,1,2],vt=function(){function i(e,r,t,n,s,a){this.boundingBoxDetector=e,this.meshDetector=r,this.meshWidth=t,this.meshHeight=n,this.maxContinuousChecks=s,this.detectionConfidence=a,this.regionsOfInterest=[],this.runsWithoutHandDetector=0,this.maxHandsNumber=1}return i.prototype.getBoxForPalmLandmarks=function(e,r){var t=e.map(function(n){return Z(B(B([],n,!0),[1],!1),r)});return U(q(J(this.calculateLandmarksBoundingBox(t),pt)),3)},i.prototype.getBoxForHandLandmarks=function(e){for(var r=U(q(J(this.calculateLandmarksBoundingBox(e),mt)),1.65),t=[],n=0;n<$.length;n++)t.push(e[$[n]].slice(0,2));return r.palmLandmarks=t,r},i.prototype.transformRawCoords=function(e,r,t,n){var s,a,u,d,c=this,o=V(r),f=[o[0]/this.meshWidth,o[1]/this.meshHeight],l=e.map(function(p){return[f[0]*(p[0]-c.meshWidth/2),f[1]*(p[1]-c.meshHeight/2),p[2]]}),h=Y(t,[0,0]),m=l.map(function(p){return B(B([],Z(p,h),!0),[p[2]],!1)}),v=(a=[[(s=n)[0][0],s[1][0]],[s[0][1],s[1][1]]],u=[s[0][2],s[1][2]],d=[-L(a[0],u),-L(a[1],u)],[a[0].concat(d[0]),a[1].concat(d[1]),[0,0,1]]),g=B(B([],E(r),!0),[1],!1),P=[L(g,v[0]),L(g,v[1])];return m.map(function(p){return[p[0]+P[0],p[1]+P[1],p[2]]})},i.prototype.estimateHand=function(e){return y(this,void 0,void 0,function(){var r,t,n,s,a,u,d,c,o,f,l,h,m,v,g,P,p,b,O,T;return k(this,function(W){switch(W.label){case 0:return(r=this.shouldUpdateRegionsOfInterest())!==!0?[3,2]:[4,this.boundingBoxDetector.estimateHandBounds(e)];case 1:return(t=W.sent())===null?(e.dispose(),this.regionsOfInterest=[],[2,null]):(this.updateRegionsOfInterest(t,!0),this.runsWithoutHandDetector=0,[3,3]);case 2:this.runsWithoutHandDetector++,W.label=3;case 3:return n=this.regionsOfInterest[0],s=ft(n.palmLandmarks[0],n.palmLandmarks[2]),a=E(n),u=[a[0]/e.shape[2],a[1]/e.shape[1]],d=S.rotateWithOffset(e,s,0,u),c=Y(-s,a),o=r===!0?this.getBoxForPalmLandmarks(n.palmLandmarks,c):n,f=function(H,D,et){var A=D.shape[1],F=D.shape[2],rt=[[H.startPoint[1]/A,H.startPoint[0]/F,H.endPoint[1]/A,H.endPoint[0]/F]];return S.cropAndResize(D,rt,[0],et)}(o,d,[this.meshWidth,this.meshHeight]),l=C(f,255),f.dispose(),d.dispose(),tt()==="webgl"?(m=I().get("WEBGL_PACK_DEPTHWISECONV"),I().set("WEBGL_PACK_DEPTHWISECONV",!0),h=this.meshDetector.predict(l),I().set("WEBGL_PACK_DEPTHWISECONV",m)):h=this.meshDetector.predict(l),v=h[0],g=h[1],l.dispose(),P=v.dataSync()[0],v.dispose(),P<this.detectionConfidence?(g.dispose(),this.regionsOfInterest=[],[2,null]):(p=R(g,[-1,3]),b=p.arraySync(),g.dispose(),p.dispose(),O=this.transformRawCoords(b,o,s,c),T=this.getBoxForHandLandmarks(O),this.updateRegionsOfInterest(T,!1),[2,{landmarks:O,handInViewConfidence:P,boundingBox:{topLeft:T.startPoint,bottomRight:T.endPoint}}])}})})},i.prototype.calculateLandmarksBoundingBox=function(e){var r=e.map(function(n){return n[0]}),t=e.map(function(n){return n[1]});return{startPoint:[Math.min.apply(Math,r),Math.min.apply(Math,t)],endPoint:[Math.max.apply(Math,r),Math.max.apply(Math,t)]}},i.prototype.updateRegionsOfInterest=function(e,r){if(r)this.regionsOfInterest=[e];else{var t=this.regionsOfInterest[0],n=0;if(t!=null&&t.startPoint!=null){var s=e.startPoint,a=s[0],u=s[1],d=e.endPoint,c=d[0],o=d[1],f=t.startPoint,l=f[0],h=f[1],m=t.endPoint,v=m[0],g=m[1],P=Math.max(a,l),p=Math.max(u,h),b=(Math.min(c,v)-P)*(Math.min(o,g)-p);n=b/((c-a)*(o-u)+(v-l)*(g-u)-b)}this.regionsOfInterest[0]=n>.8?t:e}},i.prototype.shouldUpdateRegionsOfInterest=function(){return this.regionsOfInterest.length!==this.maxHandsNumber||this.runsWithoutHandDetector>=this.maxContinuousChecks},i}();function gt(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,nt("https://tfhub.dev/mediapipe/tfjs-model/handdetector/1/default/1",{fromTFHub:!0})]})})}function Pt(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,nt("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1",{fromTFHub:!0})]})})}function bt(){return y(this,void 0,void 0,function(){return k(this,function(i){return[2,ht("https://tfhub.dev/mediapipe/tfjs-model/handskeleton/1/default/1/anchors.json?tfjs-format=file").then(function(e){return e.json()})]})})}function Lt(i){var e=i===void 0?{}:i,r=e.maxContinuousChecks,t=r===void 0?1/0:r,n=e.detectionConfidence,s=n===void 0?.8:n,a=e.iouThreshold,u=a===void 0?.3:a,d=e.scoreThreshold,c=d===void 0?.5:d;return y(this,void 0,void 0,function(){var o,f,l,h,m,v;return k(this,function(g){switch(g.label){case 0:return[4,Promise.all([bt(),gt(),Pt()])];case 1:return o=g.sent(),f=o[0],l=o[1],h=o[2],m=new ct(l,256,256,f,u,c),v=new vt(m,h,256,256,t,s),[2,new yt(v)]}})})}var yt=function(){function i(e){this.pipeline=e}return i.getAnnotations=function(){return _},i.prototype.estimateHands=function(e,r){return r===void 0&&(r=!1),y(this,void 0,void 0,function(){var t,n,s,a,u,d,c,o,f;return k(this,function(l){switch(l.label){case 0:return t=function(h){return h instanceof N?[h.shape[0],h.shape[1]]:[h.height,h.width]}(e),n=t[1],s=x(function(){return e instanceof N||(e=ot(e)),it(st(e,"float32"))}),[4,this.pipeline.estimateHand(s)];case 1:if(a=l.sent(),s.dispose(),a===null)return[2,[]];for(u=a,r===!0&&(u=function(h,m){var v=h.handInViewConfidence,g=h.landmarks,P=h.boundingBox;return{handInViewConfidence:v,landmarks:g.map(function(p){return[m-1-p[0],p[1],p[2]]}),boundingBox:{topLeft:[m-1-P.topLeft[0],P.topLeft[1]],bottomRight:[m-1-P.bottomRight[0],P.bottomRight[1]]}}}(a,n)),d={},c=0,o=Object.keys(_);c<o.length;c++)f=o[c],d[f]=_[f].map(function(h){return u.landmarks[h]});return[2,[{handInViewConfidence:u.handInViewConfidence,boundingBox:u.boundingBox,landmarks:u.landmarks,annotations:d}]]}})})},i}();export{yt as HandPose,Lt as load};
